<?php/** * A simple class to add a list subscriber using the MailChimp API * --------------------------------------------------------------- * * Validate an email address and add it to a MailChimp list * Set a public boolean success flag on the MC_Subscribe object * Set a public success/error message on the MC_Subscribe object */class MC_Subscribe {    private $api,            $list_id,            $messages;    public  $email,            $message,            $success = false;    /**     * Set internal props, then call validate() method     *     * @param MCAPI $api MailChimp API object     * @param array $messages array of messages (missing, invalid, success)     * @param $list_id unique MailChimp list ID     * @param $email email address to add to the list     */    public function __construct(MCAPI $api, array $messages, $list_id, $email)    {        $this->api = $api;        $this->list_id = $list_id;        $this->messages = $messages;        $this->email = filter_var($email, FILTER_SANITIZE_EMAIL);        $this->validate();    }    /**     * Check whether email address exists - if not, set $this->message to 'missing' message     * Validate email using filter_var() - if valid, call submit() method     * If invalid, set $this->message to 'invalid' message     */    private function validate()    {        if ($this->email)        {            if (filter_var($this->email, FILTER_VALIDATE_EMAIL))            {                $this->submit();            }            else            {                $this->message = $this->messages['invalid'];            }        }        else        {            $this->message = $this->messages['missing'];        }    }    /**     * Call MCAPI listSubscribe() method to add new subscriber     * If successful, set $this->success flag to true and $this->message to 'success' message     * If unsuccessful, set $this->message to MCAPI error message (e.g. user already subscribed)     */    private function submit()    {        if ($this->api->listSubscribe($this->list_id, $this->email))        {            $this->success = true;            $this->message = $this->messages['success'];        }        else        {            $this->message = $this->api->errorMessage;        }    }}